<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejercicio Individual: Modela tu Data Warehouse - ADEN University</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Segoe UI', system-ui, sans-serif; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // ============================================
        // DATOS DEL EJERCICIO
        // ============================================

        const empresas = [
            {
                id: 'hotel',
                nombre: 'Hotel Paraiso Tropical',
                industria: 'Hoteleria',
                icon: 'HOTEL',
                color: 'from-cyan-500 to-blue-500',
                descripcion: 'Hotel boutique de 50 habitaciones en Bocas del Toro. Ofrece alojamiento, restaurante, tours y spa. Quiere analizar ocupacion, ingresos y satisfaccion.',
                procesos: ['Reservaciones', 'Check-in/out', 'Servicios adicionales', 'Facturacion'],
                preguntas: [
                    'Cual es la ocupacion promedio por tipo de habitacion?',
                    'Que temporadas generan mas ingresos?',
                    'Cual es el ingreso por huesped (RevPAR)?',
                    'Que servicios adicionales son mas rentables?'
                ]
            },
            {
                id: 'manufactura',
                nombre: 'FabriPlast Industrial',
                industria: 'Manufactura',
                icon: 'FACTORY',
                color: 'from-orange-500 to-red-500',
                descripcion: 'Fabrica de productos plasticos con 3 lineas de produccion. Necesita analizar eficiencia, defectos, tiempos y costos de produccion.',
                procesos: ['Ordenes de produccion', 'Control de calidad', 'Inventario materiales', 'Mantenimiento'],
                preguntas: [
                    'Cual es la eficiencia por linea de produccion?',
                    'Que productos tienen mayor tasa de defectos?',
                    'Como varia el costo de produccion por turno?',
                    'Cual es el tiempo promedio de setup por maquina?'
                ]
            },
            {
                id: 'educacion',
                nombre: 'Instituto TechPro',
                industria: 'Educacion',
                icon: 'SCHOOL',
                color: 'from-purple-500 to-pink-500',
                descripcion: 'Instituto de formacion tecnica con cursos presenciales y online. 2,000 estudiantes activos. Necesita analizar rendimiento academico y retencion.',
                procesos: ['Matriculas', 'Asistencia', 'Evaluaciones', 'Certificaciones'],
                preguntas: [
                    'Cual es la tasa de aprobacion por curso?',
                    'Que factores influyen en la desercion?',
                    'Como se compara rendimiento online vs presencial?',
                    'Cual es el tiempo promedio de graduacion?'
                ]
            },
            {
                id: 'logistica',
                nombre: 'EnvioRapido Express',
                industria: 'Logistica',
                icon: 'DELIVERY',
                color: 'from-emerald-500 to-teal-500',
                descripcion: 'Empresa de mensajeria con 30 vehiculos. Cubre Panama, Colon y Chiriqui. Necesita optimizar rutas, tiempos y costos de entrega.',
                procesos: ['Recepcion de paquetes', 'Asignacion de rutas', 'Entregas', 'Devoluciones'],
                preguntas: [
                    'Cual es el tiempo promedio de entrega por zona?',
                    'Que porcentaje de entregas son a tiempo?',
                    'Cual es el costo por kilometro por vehiculo?',
                    'Que rutas tienen mayor volumen de devoluciones?'
                ]
            }
        ];

        const fases = [
            {
                id: 1,
                titulo: 'Analizar Requisitos',
                descripcion: 'Entender el negocio y las preguntas analiticas',
                promptTemplate: `Actua como un arquitecto de Data Warehouse. Estoy disenando un DW para [EMPRESA], una empresa de [INDUSTRIA].

Descripcion: [DESCRIPCION]

Procesos principales: [PROCESOS]

Preguntas de negocio a responder:
[PREGUNTAS]

Por favor:
1. Identifica el proceso de negocio principal que deberia modelarse primero
2. Lista 5-7 preguntas analiticas adicionales que un DW deberia responder
3. Identifica posibles fuentes de datos (sistemas transaccionales)
4. Sugiere la granularidad mas apropiada para la tabla de hechos

Responde de forma estructurada y practica.`
            },
            {
                id: 2,
                titulo: 'Disenar Dimensiones',
                descripcion: 'Definir las tablas de dimensiones con sus atributos',
                promptTemplate: `Continuando con el Data Warehouse para [EMPRESA] ([INDUSTRIA]):

Basandote en los procesos: [PROCESOS]

Y las preguntas de negocio a responder.

Disena las dimensiones necesarias. Para cada dimension proporciona:

1. Nombre de la tabla (usando convencion dim_nombre)
2. Descripcion del proposito
3. Lista de columnas con:
   - Nombre de columna (snake_case)
   - Tipo de dato (INT, VARCHAR, DATE, DECIMAL, BOOLEAN)
   - Si es clave primaria (PK) o atributo
   - Descripcion breve

Incluye siempre una dimension de fecha. Identifica al menos 4 dimensiones relevantes.

Presenta la informacion en formato de tabla SQL-ready.`
            },
            {
                id: 3,
                titulo: 'Disenar Tabla de Hechos',
                descripcion: 'Definir la tabla de hechos con medidas y claves',
                promptTemplate: `Para el Data Warehouse de [EMPRESA], dise√±a la tabla de hechos principal.

Proceso a modelar: [PROCESO_PRINCIPAL]
Granularidad definida: [GRANULARIDAD]

Proporciona:

1. NOMBRE DE LA TABLA (fact_[proceso])

2. CLAVES FORANEAS
   - Lista de todas las dimension_key que se relacionan
   - Cardinalidad esperada

3. HECHOS (MEDIDAS)
   Para cada hecho indica:
   - Nombre de columna
   - Tipo de dato
   - Tipo de hecho (aditivo, semi-aditivo, no-aditivo)
   - Formula si es calculado
   - Unidad de medida

4. CLAVES DEGENERADAS
   - Identificadores que van directo en la tabla de hechos

5. VOLUMETRIA ESTIMADA
   - Cuantas filas se esperan por dia/mes/ano

Incluye el SQL DDL para crear la tabla.`
            },
            {
                id: 4,
                titulo: 'Escribir SQL DDL',
                descripcion: 'Generar el codigo SQL para crear el esquema',
                promptTemplate: `Genera el codigo SQL completo para implementar el Data Warehouse de [EMPRESA] en PostgreSQL/Supabase.

Incluye:

1. DIMENSIONES (CREATE TABLE para cada una)
   - Claves primarias
   - Tipos de datos apropiados
   - Comentarios explicativos

2. TABLA DE HECHOS
   - Claves foraneas con REFERENCES
   - Constraint UNIQUE para evitar duplicados
   - Indices para performance

3. SCRIPT DE CARGA INICIAL
   - INSERT de datos de prueba (5-10 registros por dimension)
   - INSERT de hechos de ejemplo

4. CONSULTAS DE VALIDACION
   - 3 consultas SQL que demuestren que el modelo funciona
   - Cada consulta debe responder una pregunta de negocio

El codigo debe estar listo para ejecutar en Supabase SQL Editor.`
            },
            {
                id: 5,
                titulo: 'Documentar el Modelo',
                descripcion: 'Crear documentacion del Data Warehouse',
                promptTemplate: `Crea la documentacion completa del Data Warehouse de [EMPRESA].

Genera:

1. DIAGRAMA DEL MODELO (descripcion textual)
   - Nombre de cada tabla
   - Relaciones entre tablas
   - Tipo de esquema (estrella/copo de nieve)

2. DICCIONARIO DE DATOS
   Para cada tabla y columna:
   - Nombre
   - Descripcion de negocio
   - Tipo de dato
   - Valores permitidos (si aplica)
   - Fuente de datos

3. REGLAS DE NEGOCIO
   - Como se calcula cada hecho
   - Reglas de validacion de datos
   - Manejo de valores nulos

4. PROCESO ETL (alto nivel)
   - Frecuencia de carga
   - Orden de carga (primero dimensiones, luego hechos)
   - Estrategia de actualizacion

5. RECOMENDACIONES DE USO
   - Consultas frecuentes sugeridas
   - KPIs que se pueden calcular
   - Limitaciones conocidas

Formato: Documento estructurado listo para entregar como Fase 1 del proyecto.`
            }
        ];

        const recursos = [
            {
                titulo: 'Kimball Group - Dimensional Modeling Techniques',
                url: 'https://www.kimballgroup.com/data-warehouse-business-intelligence-resources/kimball-techniques/dimensional-modeling-techniques/',
                descripcion: 'Tecnicas oficiales de Kimball para modelado dimensional',
                tipo: 'Referencia'
            },
            {
                titulo: 'PostgreSQL Data Types',
                url: 'https://www.postgresql.org/docs/current/datatype.html',
                descripcion: 'Documentacion oficial de tipos de datos en PostgreSQL',
                tipo: 'Documentacion'
            },
            {
                titulo: 'Supabase SQL Editor',
                url: 'https://supabase.com/dashboard',
                descripcion: 'Ejecuta tu SQL directamente en Supabase',
                tipo: 'Herramienta'
            },
            {
                titulo: 'dbdiagram.io',
                url: 'https://dbdiagram.io/',
                descripcion: 'Herramienta online para diagramas ER',
                tipo: 'Herramienta'
            }
        ];

        // ============================================
        // COMPONENTES
        // ============================================

        const EmpresaCard = ({ empresa, isSelected, onSelect }) => (
            <button
                onClick={onSelect}
                className={`w-full text-left p-4 rounded-xl transition-all ${
                    isSelected
                        ? `bg-gradient-to-r ${empresa.color} text-white shadow-lg scale-105`
                        : 'bg-white hover:shadow-md'
                }`}
            >
                <div className="flex items-center gap-3 mb-2">
                    <span className={`text-lg ${isSelected ? 'text-white' : 'text-gray-400'}`}>{empresa.icon}</span>
                    <div>
                        <h3 className="font-bold">{empresa.nombre}</h3>
                        <p className={`text-sm ${isSelected ? 'text-white/80' : 'text-gray-500'}`}>{empresa.industria}</p>
                    </div>
                </div>
                <p className={`text-sm ${isSelected ? 'text-white/90' : 'text-gray-600'}`}>
                    {empresa.descripcion.substring(0, 100)}...
                </p>
            </button>
        );

        const PromptCard = ({ fase, empresa }) => {
            const [copied, setCopied] = useState(false);

            const generarPrompt = () => {
                return fase.promptTemplate
                    .replace(/\[EMPRESA\]/g, empresa.nombre)
                    .replace(/\[INDUSTRIA\]/g, empresa.industria)
                    .replace(/\[DESCRIPCION\]/g, empresa.descripcion)
                    .replace(/\[PROCESOS\]/g, empresa.procesos.join(', '))
                    .replace(/\[PREGUNTAS\]/g, empresa.preguntas.map((p, i) => `${i+1}. ${p}`).join('\n'))
                    .replace(/\[PROCESO_PRINCIPAL\]/g, empresa.procesos[0])
                    .replace(/\[GRANULARIDAD\]/g, 'Una fila por transaccion individual');
            };

            const handleCopy = () => {
                navigator.clipboard.writeText(generarPrompt());
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            return (
                <div className="bg-white rounded-xl shadow-sm p-6">
                    <div className="flex items-center justify-between mb-4">
                        <div className="flex items-center gap-3">
                            <span className="bg-violet-100 text-violet-800 px-3 py-1 rounded-full text-sm font-bold">
                                Fase {fase.id}
                            </span>
                            <h3 className="font-bold text-gray-800">{fase.titulo}</h3>
                        </div>
                    </div>
                    <p className="text-gray-600 mb-4">{fase.descripcion}</p>

                    <div className="bg-gray-50 rounded-xl p-4 mb-4">
                        <div className="flex justify-between items-center mb-2">
                            <span className="text-xs text-gray-500 font-medium">PROMPT PARA IA</span>
                            <button
                                onClick={handleCopy}
                                className={`px-3 py-1 rounded-lg text-sm font-medium transition-all ${
                                    copied ? 'bg-green-500 text-white' : 'bg-violet-500 text-white hover:bg-violet-600'
                                }`}
                            >
                                {copied ? '‚úì Copiado!' : 'Copiar'}
                            </button>
                        </div>
                        <pre className="text-sm text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded-lg border max-h-48 overflow-y-auto">
                            {generarPrompt()}
                        </pre>
                    </div>

                    <div className="flex gap-2">
                        <a href="https://chat.openai.com" target="_blank" rel="noopener noreferrer"
                           className="flex-1 text-center py-2 bg-emerald-500 text-white rounded-lg text-sm font-medium hover:bg-emerald-600">
                            ChatGPT
                        </a>
                        <a href="https://claude.ai" target="_blank" rel="noopener noreferrer"
                           className="flex-1 text-center py-2 bg-orange-500 text-white rounded-lg text-sm font-medium hover:bg-orange-600">
                            Claude
                        </a>
                        <a href="https://gemini.google.com" target="_blank" rel="noopener noreferrer"
                           className="flex-1 text-center py-2 bg-blue-500 text-white rounded-lg text-sm font-medium hover:bg-blue-600">
                            Gemini
                        </a>
                    </div>
                </div>
            );
        };

        const EntregablePanel = () => {
            const [items, setItems] = useState({});

            const checklistItems = [
                'Analisis de requisitos y preguntas de negocio',
                'Dise√±o de dimensiones (minimo 4)',
                'Dise√±o de tabla de hechos con medidas',
                'Codigo SQL DDL completo',
                'Datos de prueba cargados',
                'Consultas de validacion ejecutadas',
                'Diccionario de datos documentado',
                'Capturas de las conversaciones con IA'
            ];

            const toggleItem = (idx) => setItems(prev => ({ ...prev, [idx]: !prev[idx] }));
            const completados = Object.values(items).filter(Boolean).length;

            return (
                <div className="bg-gradient-to-r from-violet-50 to-purple-50 rounded-xl p-6">
                    <h3 className="font-bold text-violet-800 mb-4">Entregables - Fase 1 Proyecto</h3>
                    <div className="space-y-2 mb-4">
                        {checklistItems.map((item, idx) => (
                            <label key={idx} className="flex items-center gap-3 cursor-pointer">
                                <input
                                    type="checkbox"
                                    checked={items[idx] || false}
                                    onChange={() => toggleItem(idx)}
                                    className="w-5 h-5 text-violet-600 rounded"
                                />
                                <span className={items[idx] ? 'text-gray-500 line-through' : 'text-gray-700'}>{item}</span>
                            </label>
                        ))}
                    </div>
                    <div className="bg-white rounded-lg p-3">
                        <div className="flex justify-between text-sm mb-1">
                            <span>Progreso</span>
                            <span className="font-bold">{completados}/{checklistItems.length}</span>
                        </div>
                        <div className="w-full bg-gray-200 rounded-full h-2">
                            <div
                                className="bg-violet-500 rounded-full h-2 transition-all"
                                style={{ width: `${(completados / checklistItems.length) * 100}%` }}
                            />
                        </div>
                    </div>
                    {completados === checklistItems.length && (
                        <div className="mt-4 p-3 bg-green-100 border border-green-300 rounded-lg text-center">
                            <p className="text-green-800 font-bold">üéâ Fase 1 Lista para Entregar!</p>
                        </div>
                    )}
                </div>
            );
        };

        const RecursosPanel = () => (
            <div className="bg-white rounded-xl shadow-sm p-6">
                <h3 className="font-bold text-gray-800 mb-4">Recursos de Apoyo</h3>
                <div className="space-y-3">
                    {recursos.map((recurso, idx) => (
                        <a
                            key={idx}
                            href={recurso.url}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="block p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-all"
                        >
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="font-medium text-gray-800">{recurso.titulo}</p>
                                    <p className="text-sm text-gray-500">{recurso.descripcion}</p>
                                </div>
                                <span className="bg-indigo-100 text-indigo-800 px-2 py-1 rounded text-xs">
                                    {recurso.tipo}
                                </span>
                            </div>
                        </a>
                    ))}
                </div>
            </div>
        );

        // ============================================
        // COMPONENTE PRINCIPAL
        // ============================================

        const DWExercise = () => {
            const [empresaSeleccionada, setEmpresaSeleccionada] = useState(null);
            const [faseActiva, setFaseActiva] = useState(1);

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-100 to-slate-200 p-4">
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-gradient-to-r from-violet-600 to-purple-600 text-white p-6 rounded-xl shadow-lg mb-6">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-2xl font-bold mb-1">Ejercicio: Modela tu Data Warehouse</h1>
                                    <p className="text-violet-100">Sesion 04 - Entregable Fase 1 del Proyecto</p>
                                </div>
                                <div className="flex gap-2">
                                    <a href="./" className="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg text-sm">‚Üê Simulador</a>
                                    <a href="laboratorio.html" className="bg-emerald-500 hover:bg-emerald-600 px-4 py-2 rounded-lg text-sm">Lab Guiado</a>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-xl shadow-sm p-6 mb-6">
                            <h2 className="text-xl font-bold text-gray-800 mb-3">Instrucciones</h2>
                            <div className="grid md:grid-cols-3 gap-4 text-sm">
                                <div className="bg-amber-50 rounded-lg p-4">
                                    <p className="font-bold text-amber-800 mb-1">1. Elige un Caso</p>
                                    <p className="text-gray-600">Selecciona una industria diferente al laboratorio.</p>
                                </div>
                                <div className="bg-amber-50 rounded-lg p-4">
                                    <p className="font-bold text-amber-800 mb-1">2. Usa los Prompts</p>
                                    <p className="text-gray-600">Sigue las 5 fases con ayuda de IA.</p>
                                </div>
                                <div className="bg-amber-50 rounded-lg p-4">
                                    <p className="font-bold text-amber-800 mb-1">3. Implementa en Supabase</p>
                                    <p className="text-gray-600">Ejecuta el SQL y valida con consultas.</p>
                                </div>
                            </div>
                        </div>

                        {!empresaSeleccionada ? (
                            <div className="bg-white rounded-xl shadow-sm p-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-4">Selecciona tu Caso de Estudio</h2>
                                <div className="grid md:grid-cols-2 gap-4">
                                    {empresas.map((empresa) => (
                                        <EmpresaCard
                                            key={empresa.id}
                                            empresa={empresa}
                                            isSelected={false}
                                            onSelect={() => setEmpresaSeleccionada(empresa)}
                                        />
                                    ))}
                                </div>
                            </div>
                        ) : (
                            <div className="grid md:grid-cols-3 gap-6">
                                <div className="space-y-6">
                                    <div className={`bg-gradient-to-r ${empresaSeleccionada.color} text-white p-6 rounded-xl`}>
                                        <div className="flex justify-between items-start mb-4">
                                            <div>
                                                <h3 className="text-xl font-bold">{empresaSeleccionada.nombre}</h3>
                                                <p className="text-white/80">{empresaSeleccionada.industria}</p>
                                            </div>
                                            <button onClick={() => setEmpresaSeleccionada(null)} className="text-white/60 hover:text-white">
                                                Cambiar
                                            </button>
                                        </div>
                                        <p className="text-sm text-white/90">{empresaSeleccionada.descripcion}</p>
                                    </div>

                                    <div className="bg-white rounded-xl shadow-sm p-4">
                                        <h4 className="font-bold text-gray-800 mb-3">Preguntas de Negocio</h4>
                                        <ul className="space-y-2">
                                            {empresaSeleccionada.preguntas.map((preg, idx) => (
                                                <li key={idx} className="flex items-start gap-2 text-sm text-gray-600">
                                                    <span className="text-indigo-500">‚Ä¢</span>{preg}
                                                </li>
                                            ))}
                                        </ul>
                                    </div>

                                    <EntregablePanel />
                                </div>

                                <div className="md:col-span-2 space-y-6">
                                    <div className="flex gap-2 bg-white p-2 rounded-xl shadow-sm overflow-x-auto">
                                        {fases.map((fase) => (
                                            <button
                                                key={fase.id}
                                                onClick={() => setFaseActiva(fase.id)}
                                                className={`flex-shrink-0 py-2 px-4 rounded-lg font-medium transition-all ${
                                                    faseActiva === fase.id
                                                        ? 'bg-violet-500 text-white'
                                                        : 'text-gray-600 hover:bg-gray-100'
                                                }`}
                                            >
                                                Fase {fase.id}
                                            </button>
                                        ))}
                                    </div>

                                    <PromptCard fase={fases.find(f => f.id === faseActiva)} empresa={empresaSeleccionada} />
                                    <RecursosPanel />
                                </div>
                            </div>
                        )}

                        <div className="mt-8 text-center text-gray-500 text-sm">
                            <p>ADEN University - Taller de Tecnologia Aplicada - Sesion 04</p>
                            <p className="mt-1">Docente: Ulises Javier Gonzalez Diaz</p>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DWExercise />);
    </script>
</body>
</html>
